---
apiVersion: v1
kind: Service
metadata:
  name: pogocache
  labels:
    app: pogocache
spec:
  type: ClusterIP
  ports:
    - port: 9401
      targetPort: 9401
      protocol: TCP
      name: pogocache
  selector:
    app: pogocache
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pogocache
  labels:
    app: pogocache
spec:
  replicas: 1
  selector:
    matchLabels:
      app: pogocache
  template:
    metadata:
      labels:
        app: pogocache
    spec:
      containers:
      - name: pogocache
        image: ghcr.io/franzramadhan/pogocache:alpine-1.3.0
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 9401
          name: pogocache
          protocol: TCP
        env:
        # Basic options - host is set to 0.0.0.0 by default in entrypoint
        - name: POGOCACHE_PORT
          value: "9401"
        # Uncomment and configure as needed:
        # - name: POGOCACHE_VERBOSE
        #   value: "-v"
        #
        # # Additional options
        # - name: POGOCACHE_THREADS
        #   value: "32"
        # - name: POGOCACHE_MAXMEMORY
        #   value: "80%"
        # - name: POGOCACHE_EVICT
        #   value: "yes"
        # - name: POGOCACHE_MAXCONNS
        #   value: "1024"
        #
        # # Security options
        # - name: POGOCACHE_AUTH
        #   valueFrom:
        #     secretKeyRef:
        #       name: pogocache-secret
        #       key: auth-token
        #
        # # For persistence (requires volume mount)
        # - name: POGOCACHE_PERSIST
        #   value: "/data/pogocache.db"
        resources:
          requests:
            memory: "128Mi"
            cpu: "100m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          tcpSocket:
            port: 9401
          initialDelaySeconds: 10
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        readinessProbe:
          tcpSocket:
            port: 9401
          initialDelaySeconds: 5
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 2
        # Uncomment if using persistence
        # volumeMounts:
        # - name: data
        #   mountPath: /data
      # Uncomment if using persistence
      # volumes:
      # - name: data
      #   persistentVolumeClaim:
      #     claimName: pogocache-pvc
---
# Optional: PersistentVolumeClaim for data persistence
# Uncomment if you want to enable persistence
# apiVersion: v1
# kind: PersistentVolumeClaim
# metadata:
#   name: pogocache-pvc
# spec:
#   accessModes:
#     - ReadWriteOnce
#   resources:
#     requests:
#       storage: 1Gi
---
# Optional: Secret for authentication
# Create this if you want to enable authentication
# apiVersion: v1
# kind: Secret
# metadata:
#   name: pogocache-secret
# type: Opaque
# stringData:
#   auth-token: "your-secure-token-here"
